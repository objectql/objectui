---
title: "插件 AgGrid"
---

import { InteractiveDemo } from '@/app/components/InteractiveDemo';
import { PluginLoader } from '@/app/components/PluginLoader';

基于 AG Grid 社区版的数据表格组件,支持延迟加载以优化性能。

## 安装

```bash
npm install @object-ui/plugin-aggrid ag-grid-community ag-grid-react
```

注意：`ag-grid-community` 和 `ag-grid-react` 是对等依赖项,必须单独安装。

<PluginLoader plugins={['aggrid']}>

## 交互式示例

### 基础数据表格

<InteractiveDemo
  schema={{
    type: "aggrid",
    rowData: [
      { make: "特斯拉", model: "Model Y", price: 64950, year: 2024 },
      { make: "福特", model: "F-Series", price: 33850, year: 2024 },
      { make: "丰田", model: "卡罗拉", price: 29600, year: 2024 },
      { make: "本田", model: "思域", price: 27500, year: 2024 },
      { make: "雪佛兰", model: "Silverado", price: 36800, year: 2024 }
    ],
    columnDefs: [
      { field: "make", headerName: "品牌", sortable: true, filter: true },
      { field: "model", headerName: "型号", sortable: true, filter: true },
      { field: "year", headerName: "年份", sortable: true, filter: "number" },
      { field: "price", headerName: "价格", sortable: true, filter: "number" }
    ],
    height: 400
  }}
  title="基础 AG Grid"
  description="启用排序和过滤的简单数据表格"
/>

### 启用分页

<InteractiveDemo
  schema={{
    type: "aggrid",
    rowData: [
      { id: 1, name: "张三", department: "工程部", salary: 95000, status: "在职" },
      { id: 2, name: "李四", department: "市场部", salary: 72000, status: "在职" },
      { id: 3, name: "王五", department: "销售部", salary: 68000, status: "在职" },
      { id: 4, name: "赵六", department: "工程部", salary: 88000, status: "在职" },
      { id: 5, name: "孙七", department: "人力资源", salary: 65000, status: "在职" },
      { id: 6, name: "周八", department: "工程部", salary: 102000, status: "在职" },
      { id: 7, name: "吴九", department: "市场部", salary: 75000, status: "休假" },
      { id: 8, name: "郑十", department: "销售部", salary: 71000, status: "在职" }
    ],
    columnDefs: [
      { field: "id", headerName: "ID", sortable: true, filter: "number", width: 80 },
      { field: "name", headerName: "姓名", sortable: true, filter: true },
      { field: "department", headerName: "部门", sortable: true, filter: true },
      { field: "salary", headerName: "薪资", sortable: true, filter: "number" },
      { field: "status", headerName: "状态", sortable: true, filter: true }
    ],
    pagination: true,
    paginationPageSize: 5,
    height: 400
  }}
  title="带分页的表格"
  description="启用分页的数据表格（每页5行）"
/>

### 行内编辑

<InteractiveDemo
  schema={{
    type: "aggrid",
    rowData: [
      { id: 1, product: "笔记本电脑", price: 1299, quantity: 5, inStock: true },
      { id: 2, product: "鼠标", price: 49, quantity: 15, inStock: true },
      { id: 3, product: "键盘", price: 89, quantity: 8, inStock: true },
      { id: 4, product: "显示器", price: 499, quantity: 3, inStock: false },
      { id: 5, product: "摄像头", price: 129, quantity: 12, inStock: true }
    ],
    columnDefs: [
      { field: "id", headerName: "ID", sortable: true },
      { field: "product", headerName: "产品", sortable: true, filter: true, editable: true },
      { field: "price", headerName: "价格 ($)", sortable: true, filter: "number", editable: true },
      { field: "quantity", headerName: "数量", sortable: true, filter: "number", editable: true },
      { field: "inStock", headerName: "有货", sortable: true, editable: true }
    ],
    editable: true,
    singleClickEdit: false,
    height: 350
  }}
  title="行内编辑"
  description="双击任意单元格进行编辑。更改会立即反映。"
/>

### CSV 导出

<InteractiveDemo
  schema={{
    type: "aggrid",
    rowData: [
      { orderID: "ORD-001", customer: "Acme 公司", amount: 15750, date: "2024-01-15", status: "已送达" },
      { orderID: "ORD-002", customer: "TechStart 科技", amount: 8500, date: "2024-01-18", status: "已发货" },
      { orderID: "ORD-003", customer: "全球方案", amount: 22300, date: "2024-01-20", status: "处理中" },
      { orderID: "ORD-004", customer: "创新实验室", amount: 12100, date: "2024-01-22", status: "已送达" },
      { orderID: "ORD-005", customer: "未来系统", amount: 9800, date: "2024-01-25", status: "已发货" }
    ],
    columnDefs: [
      { field: "orderID", headerName: "订单ID", sortable: true, filter: true },
      { field: "customer", headerName: "客户", sortable: true, filter: true },
      { field: "amount", headerName: "金额", sortable: true, filter: "number" },
      { field: "date", headerName: "日期", sortable: true, filter: "date" },
      { field: "status", headerName: "状态", sortable: true, filter: true }
    ],
    exportConfig: {
      enabled: true,
      fileName: "orders.csv"
    },
    height: 350
  }}
  title="CSV 导出"
  description="点击导出 CSV 按钮下载表格数据"
/>

### 状态栏与聚合

<InteractiveDemo
  schema={{
    type: "aggrid",
    rowData: [
      { item: "笔记本", category: "电子产品", price: 1299, quantity: 5 },
      { item: "办公桌", category: "家具", price: 599, quantity: 3 },
      { item: "椅子", category: "家具", price: 299, quantity: 8 },
      { item: "显示器", category: "电子产品", price: 499, quantity: 6 },
      { item: "键盘", category: "电子产品", price: 89, quantity: 12 },
      { item: "鼠标", category: "电子产品", price: 49, quantity: 15 }
    ],
    columnDefs: [
      { field: "item", headerName: "项目", sortable: true, filter: true },
      { field: "category", headerName: "类别", sortable: true, filter: true },
      { field: "price", headerName: "价格 ($)", sortable: true, filter: "number", aggFunc: "sum" },
      { field: "quantity", headerName: "数量", sortable: true, filter: "number", aggFunc: "sum" }
    ],
    statusBar: {
      enabled: true,
      aggregations: ["count", "sum", "avg"]
    },
    rowSelection: "multiple",
    height: 400
  }}
  title="状态栏"
  description="状态栏在底部显示聚合。选择行以查看聚合值。"
/>

### 右键菜单

<InteractiveDemo
  schema={{
    type: "aggrid",
    rowData: [
      { id: 1, name: "张三", role: "工程师", salary: 95000 },
      { id: 2, name: "李四", role: "设计师", salary: 72000 },
      { id: 3, name: "王五", role: "经理", salary: 88000 },
      { id: 4, name: "赵六", role: "工程师", salary: 102000 },
      { id: 5, name: "孙七", role: "设计师", salary: 75000 }
    ],
    columnDefs: [
      { field: "id", headerName: "ID", sortable: true },
      { field: "name", headerName: "姓名", sortable: true, filter: true },
      { field: "role", headerName: "职位", sortable: true, filter: true },
      { field: "salary", headerName: "薪资", sortable: true, filter: "number" }
    ],
    contextMenu: {
      enabled: true,
      items: ["copy", "copyWithHeaders", "separator", "export", "autoSizeAll"]
    },
    height: 350
  }}
  title="右键菜单"
  description="右键点击表格访问上下文菜单选项"
/>

## AG Grid 社区版 vs 企业版

此插件使用 **AG Grid 社区版**，它是免费且开源的。上面示例中显示的所有功能都可以在社区版中使用。某些高级功能如集成图表 (`enableCharts`) 可能需要 AG Grid 企业版（商业许可）。详情请参阅 [AG Grid 价格](https://www.ag-grid.com/license-pricing/)。

## 功能特性

- **延迟加载**：AG Grid 库按需加载以优化性能
- **零配置**：只需导入包并在 schema 中使用 `type: 'aggrid'`
- **自动注册**：组件自动注册到 ComponentRegistry
- **完整 AG Grid 功能**：排序、过滤、分页、行选择等
- **行内编辑**：单击或双击模式直接编辑单元格
- **CSV 导出**：内置导出功能，可自定义选项
- **状态栏**：在底部显示聚合（计数、求和、平均、最小、最大）
- **右键菜单**：带复制、导出和自定义操作的右键菜单
- **列配置**：可调整大小、可排序和可过滤列的全局设置
- **事件回调**：处理单元格点击、选择更改、值编辑和导出
- **范围选择**：类似 Excel 的范围选择支持
- **多种主题**：Quartz（默认）、Alpine、Balham 和 Material
- **可自定义**：完全访问 AG Grid 的 GridOptions 进行高级配置

## Schema API

```plaintext
{
  type: 'aggrid',
  
  // 数据
  rowData?: any[],                              // 表格数据（必需）
  columnDefs?: ColDef[],                        // 列定义（必需）
  
  // 显示
  pagination?: boolean,                         // 启用分页（默认：false）
  paginationPageSize?: number,                  // 每页行数（默认：10）
  theme?: 'quartz' | 'alpine' | 'balham' | 'material',  // 表格主题（默认：'quartz'）
  height?: number | string,                     // 表格高度（默认：500）
  rowSelection?: 'single' | 'multiple',         // 行选择模式
  domLayout?: 'normal' | 'autoHeight' | 'print', // 布局模式
  animateRows?: boolean,                        // 动画行更改（默认：true）
  
  // 编辑
  editable?: boolean,                           // 启用单元格编辑（默认：false）
  editType?: 'fullRow',                         // 行编辑模式
  singleClickEdit?: boolean,                    // 单击开始编辑（默认：false）
  stopEditingWhenCellsLoseFocus?: boolean,      // 失焦时停止编辑（默认：true）
  
  // 导出
  exportConfig?: {
    enabled?: boolean,                          // 显示导出按钮（默认：false）
    fileName?: string,                          // 导出文件名（默认：'export.csv'）
    skipColumnHeaders?: boolean,                // 跳过列标题（默认：false）
    onlySelected?: boolean,                     // 仅导出选中行（默认：false）
    allColumns?: boolean                        // 导出所有列（默认：false）
  },
  
  // 状态栏
  statusBar?: {
    enabled?: boolean,                          // 显示状态栏（默认：false）
    aggregations?: ('sum' | 'avg' | 'count' | 'min' | 'max')[] // 要显示的聚合
  },
  
  // 右键菜单
  contextMenu?: {
    enabled?: boolean,                          // 启用右键菜单（默认：false）
    items?: string[],                           // 菜单项：'copy'、'export'、'autoSizeAll' 等
    customItems?: Array<{                       // 自定义菜单项
      name: string,
      action: string,
      icon?: string,
      disabled?: boolean
    }>
  },
  
  // 列配置
  columnConfig?: {
    resizable?: boolean,                        // 所有列可调整大小
    sortable?: boolean,                         // 所有列可排序
    filterable?: boolean,                       // 所有列可过滤
  },
  enableRangeSelection?: boolean,               // 启用类 Excel 范围选择（默认：false）
  
  // 事件回调
  callbacks?: {
    onCellClicked?: (event) => void,            // 单元格点击处理程序
    onRowClicked?: (event) => void,             // 行点击处理程序
    onSelectionChanged?: (event) => void,       // 选择更改处理程序
    onCellValueChanged?: (event) => void,       // 单元格值更改处理程序
    onExport?: (data, format) => void           // 导出处理程序
  },
  
  // 高级
  gridOptions?: GridOptions,                    // 高级 AG Grid 选项
  className?: string                            // Tailwind 类
}
```

## 使用方法

### 基本设置

```plaintext
// 在应用入口点（例如 App.tsx 或 main.tsx）
import '@object-ui/plugin-aggrid';

// 现在可以在 schema 中使用 aggrid 类型
const schema = {
  type: 'aggrid',
  rowData: [
    { make: '特斯拉', model: 'Model Y', price: 64950 },
    { make: '福特', model: 'F-Series', price: 33850 },
    { make: '丰田', model: '卡罗拉', price: 29600 }
  ],
  columnDefs: [
    { field: 'make', headerName: '品牌', sortable: true, filter: true },
    { field: 'model', headerName: '型号', sortable: true, filter: true },
    { field: 'price', headerName: '价格', sortable: true, filter: 'number' }
  ],
  pagination: true,
  paginationPageSize: 10,
  theme: 'quartz',
  height: 500
};
```

### TypeScript 支持

```plaintext
import type { AgGridSchema } from '@object-ui/plugin-aggrid';

const schema: AgGridSchema = {
  type: 'aggrid',
  rowData: [...],
  columnDefs: [...],
  pagination: true,
  theme: 'quartz'
};
```

## 性能

插件使用延迟加载来最小化包大小影响：

- **初始加载**：+0.19 KB（仅入口点）
- **渲染时**：+200-300 KB（按需加载 AG Grid 库）

这使得不在每个页面上使用数据表格的应用程序的初始页面加载速度明显更快。

## 资源

- [AG Grid 社区文档](https://www.ag-grid.com/documentation/)
- [列定义指南](https://www.ag-grid.com/documentation/javascript/column-definitions/)
- [Grid Options 参考](https://www.ag-grid.com/documentation/javascript/grid-options/)

</PluginLoader>
